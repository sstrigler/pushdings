<!DOCTYPE HTML>
<html>
  <head>
    <script type="text/javascript">

var app_id = "123";
var app_token = "topSecret";

var user_id = "user_123";
var user_token = "my_token";

var api_uri = "http://localhost:8080/messages";

function send(form, preset)
{
    var el = form.elements.message;
    console.log(el.value);

    if (el.value == preset) return false;

    ajax_send(el.value);

    el.value = '';
    return false;
}

function ajax_send(msg) {
    var r = new XMLHttpRequest();
    r.open("POST", api_uri, false);
    r.setRequestHeader("Content-type", "application/json");
    r.setRequestHeader("Pushdings-App-Id", app_id);
    r.setRequestHeader("Pushdings-App-Token", app_token);
    r.send(JSON.stringify(msg));
}

function maybe_clear(el, preset) {
    if (el.value == preset) el.value = '';
}

function connect() {
    if (!("WebSocket" in window)) {
        alert("This browser does not support WebSockets");
    }

    /* @todo: Change to your own server IP address */
    var ws = new WebSocket("ws://localhost:8080/ws", "pushdings_v1");
    ws.onopen = function() {
        console.log('Connected');
        ws.send(JSON.stringify(
            {app_id: app_id, user_id: user_id, user_token: user_token}));
    };
    ws.onmessage = function (evt)
    {
        var received_msg = evt.data;
        console.log("Received: " + received_msg);
        var text = document.createTextNode("Simple Simon says: " + received_msg);
        var div  = document.createElement("div");
        div.appendChild(text);
        document.getElementById('msgs').appendChild(div);
    };
    ws.onclose = function()
    {
        console.log('Connection closed');
    };
    return false;
}
onload  = connect;
    </script>
  </head>
  <body>
    <div id="sse">
    <form onsubmit='return send(this, "Your message ...");'>
    <textarea name='message' onclick='maybe_clear(this, "Your message ...");'>Your message ...</textarea><br/>
    <button type='submit' href='#' ">Send message to all</button><br/>
    </form>
    </div>
    <div id="msgs">
    </div>
  </body>
</html>
